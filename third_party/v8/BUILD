# bazel build file for v8 lib and d8 shell.
# TODO: for x64 only, no i18n support yet.

# Requirements:
# cd third_party/v8
# git clone https://chromium.googlesource.com/v8/v8.git upstream
# git clone https://chromium.googlesource.com/chromium/src/base/trace_event/common.git base/trace_event/common

licenses(["notice"])

# Disable i18n, because we don't need it yet.
v8_enable_i18n_support = False

# Enable the snapshot feature, for fast context creation.
# http://v8project.blogspot.com/2015/09/custom-startup-snapshots.html
v8_use_snapshot = True

v8_enable_handle_zapping = True

v8_random_seed = "314159265"

cc_library(
  name = "v8",
  visibility = [ "//visibility:public" ],
  deps = [
    ":v8_snapshot",
    ":v8_base",
  ],
  includes = [
    "upstream/include",
  ],
)

py_binary(
  name = "js2c",
  srcs = [
    "upstream/tools/js2c.py",
    "upstream/tools/jsmin.py",
  ],
)

genrule(
  name = "js2c_js",
  tools = [
    ":js2c",
  ],
  cmd = "$(location :js2c) $@ CORE $(SRCS)",
  srcs = [
    "upstream/src/js/macros.py",
    "upstream/src/messages.h",
    "upstream/src/js/prologue.js",
    "upstream/src/js/runtime.js",
    "upstream/src/js/v8natives.js",
    "upstream/src/js/symbol.js",
    "upstream/src/js/array.js",
    "upstream/src/js/string.js",
    "upstream/src/js/uri.js",
    "upstream/src/js/math.js",
    "upstream/src/third_party/fdlibm/fdlibm.js",
    "upstream/src/js/regexp.js",
    "upstream/src/js/arraybuffer.js",
    "upstream/src/js/typedarray.js",
    "upstream/src/js/iterator-prototype.js",
    "upstream/src/js/generator.js",
    "upstream/src/js/object-observe.js",
    "upstream/src/js/collection.js",
    "upstream/src/js/weak-collection.js",
    "upstream/src/js/collection-iterator.js",
    "upstream/src/js/promise.js",
    "upstream/src/js/messages.js",
    "upstream/src/js/json.js",
    "upstream/src/js/array-iterator.js",
    "upstream/src/js/string-iterator.js",
    "upstream/src/js/templates.js",
    "upstream/src/js/spread.js",
    "upstream/src/debug/mirrors.js",
    "upstream/src/debug/debug.js",
    "upstream/src/debug/liveedit.js",
    # "upstream/src/js/i18n.js",
  ],
  outs = [
    "libraries.cc",
  ],
)

genrule(
  name = "js2c_experimental",
  tools = [
    ":js2c",
  ],
  cmd = "$(location :js2c) $@ EXPERIMENTAL $(SRCS)",
  srcs = [
    "upstream/src/js/macros.py",
    "upstream/src/messages.h",
    "upstream/src/js/proxy.js",
    "upstream/src/js/generator.js",
    "upstream/src/js/harmony-atomics.js",
    "upstream/src/js/harmony-regexp.js",
    "upstream/src/js/harmony-reflect.js",
    "upstream/src/js/harmony-object-observe.js",
    "upstream/src/js/harmony-sharedarraybuffer.js",
    "upstream/src/js/harmony-simd.js",
    "upstream/src/js/harmony-species.js",
    "upstream/src/js/harmony-unicode-regexps.js",
    "upstream/src/js/promise-extra.js"
  ],
  outs = [
    "experimental-libraries.cc",
  ],
)

genrule(
  name = "js2c_extras",
  tools = [
    ":js2c",
  ],
  cmd = "$(location :js2c) $@ EXTRAS $(SRCS)",
  srcs = [
  ],
  outs = [
    "extra-libraries.cc",
  ],
)

genrule(
  name = "js2c_experimental_extras",
  tools = [
    ":js2c",
  ],
  cmd = "$(location :js2c) $@ EXPERIMENTAL_EXTRAS $(SRCS)",
  srcs = [
  ],
  outs = [
    "experimental-extra-libraries.cc",
  ],
)

genrule(
  name = "d8_js2c",
  tools = [
    ":js2c",
  ],
  cmd = "$(location :js2c) $@ D8 $(SRCS)",
  srcs = [
    "upstream/src/d8.js",
    "upstream/src/js/macros.py",
  ],
  outs = [
    "d8-js.cc",
  ],
)

cc_binary(
  name = "mksnapshot",
  srcs = [
    "upstream/src/snapshot/mksnapshot.cc",
  ],
  deps = [
    ":v8_base",
    ":v8_libplatform",
    ":v8_nosnapshot",
  ]
)

genrule(
  name = "run_mksnapshot",
  tools = [
    ":mksnapshot",
  ],
  srcs = [
    "upstream/tools/run.py",
  ],
  outs = [
    "snapshot.cc",
  ],
  cmd = ("$< $(location :mksnapshot) --log-snapshot-positions " +
         "--logfile $@.log --startup_src $@ " +
         "--random-seed " + str(v8_random_seed))
)

cc_library(
  name = "v8_libbase",
  hdrs = glob([
    "upstream/src/base/**/*.h",
  ]) + [
    "upstream/include/v8config.h",
  ],
  srcs = [
    "upstream/src/base/adapters.h",
    "upstream/src/base/atomicops.h",
    "upstream/src/base/atomicops_internals_arm64_gcc.h",
    "upstream/src/base/atomicops_internals_arm_gcc.h",
    "upstream/src/base/atomicops_internals_atomicword_compat.h",
    "upstream/src/base/atomicops_internals_mac.h",
    "upstream/src/base/atomicops_internals_mips_gcc.h",
    "upstream/src/base/atomicops_internals_mips64_gcc.h",
    "upstream/src/base/atomicops_internals_portable.h",
    "upstream/src/base/atomicops_internals_tsan.h",
    "upstream/src/base/atomicops_internals_x86_gcc.cc",
    "upstream/src/base/atomicops_internals_x86_gcc.h",
    "upstream/src/base/atomicops_internals_x86_msvc.h",
    "upstream/src/base/bits.cc",
    "upstream/src/base/bits.h",
    "upstream/src/base/build_config.h",
    "upstream/src/base/cpu.cc",
    "upstream/src/base/cpu.h",
    "upstream/src/base/division-by-constant.cc",
    "upstream/src/base/division-by-constant.h",
    "upstream/src/base/flags.h",
    "upstream/src/base/functional.cc",
    "upstream/src/base/functional.h",
    "upstream/src/base/iterator.h",
    "upstream/src/base/lazy-instance.h",
    "upstream/src/base/logging.cc",
    "upstream/src/base/logging.h",
    "upstream/src/base/macros.h",
    "upstream/src/base/once.cc",
    "upstream/src/base/once.h",
    "upstream/src/base/platform/elapsed-timer.h",
    "upstream/src/base/platform/time.cc",
    "upstream/src/base/platform/time.h",
    "upstream/src/base/platform/condition-variable.cc",
    "upstream/src/base/platform/condition-variable.h",
    "upstream/src/base/platform/mutex.cc",
    "upstream/src/base/platform/mutex.h",
    "upstream/src/base/platform/platform.h",
    "upstream/src/base/platform/semaphore.cc",
    "upstream/src/base/platform/semaphore.h",
    "upstream/src/base/platform/platform-posix.cc",
    "upstream/src/base/platform/platform-linux.cc",
    "upstream/src/base/safe_conversions.h",
    "upstream/src/base/safe_conversions_impl.h",
    "upstream/src/base/safe_math.h",
    "upstream/src/base/safe_math_impl.h",
    "upstream/src/base/smart-pointers.h",
    "upstream/src/base/sys-info.cc",
    "upstream/src/base/sys-info.h",
    "upstream/src/base/utils/random-number-generator.cc",
    "upstream/src/base/utils/random-number-generator.h",
  ],
  includes = [
    "upstream",
  ],
  defines = [
    "V8_TARGET_ARCH_X64",
    "ENABLE_HANDLE_ZAPPING",
  ],
  copts = [
    "-pthread",
  ],
  linkopts = [
    "-pthread",
    "-ldl",
  ],
)

cc_library(
  name = "v8_external_snapshot",
  deps = [
    # ":js2c_js",
    # ":js2c_experimental",
    # ":js2c_extras",
    # ":js2c_experimental_extras",
    ":v8_base",
    #":natives_blob",
    #":run_mksnapshot",
  ],
  srcs = [
    "upstream/src/snapshot/natives-external.cc",
    "upstream/src/snapshot/snapshot-external.cc",
  ],
)

cc_library(
  name = "v8_base",
  hdrs = glob([
    "upstream/src/*.h",
  ]),
  srcs = [
    ":js2c_js",
    ":js2c_experimental",
    ":js2c_extras",
    ":js2c_experimental_extras",
    # TODO(fmeawad): This needs to be updated to support standalone V8 builds.
    "base/trace_event/common/trace_event_common.h",
    "upstream/include/v8-debug.h",
    "upstream/include/v8-experimental.h",
    "upstream/include/v8-platform.h",
    "upstream/include/v8-profiler.h",
    "upstream/include/v8-testing.h",
    "upstream/include/v8-util.h",
    "upstream/include/v8-version.h",
    "upstream/include/v8.h",
    "upstream/include/v8config.h",
    "upstream/src/accessors.cc",
    "upstream/src/accessors.h",
    "upstream/src/address-map.cc",
    "upstream/src/address-map.h",
    "upstream/src/allocation.cc",
    "upstream/src/allocation.h",
    "upstream/src/allocation-site-scopes.cc",
    "upstream/src/allocation-site-scopes.h",

    "upstream/src/api.h",
    "upstream/src/api-experimental.cc",
    "upstream/src/api-experimental.h",
    "upstream/src/api-natives.cc",
    "upstream/src/api-natives.h",
    "upstream/src/arguments.cc",
    "upstream/src/arguments.h",
    "upstream/src/assembler.cc",
    "upstream/src/assembler.h",
    "upstream/src/assert-scope.h",
    "upstream/src/assert-scope.cc",
    "upstream/src/ast/ast-expression-rewriter.cc",
    "upstream/src/ast/ast-expression-rewriter.h",
    "upstream/src/ast/ast-expression-visitor.cc",
    "upstream/src/ast/ast-expression-visitor.h",
    "upstream/src/ast/ast-literal-reindexer.cc",
    "upstream/src/ast/ast-literal-reindexer.h",
    "upstream/src/ast/ast-numbering.cc",
    "upstream/src/ast/ast-numbering.h",
    "upstream/src/ast/ast-value-factory.cc",
    "upstream/src/ast/ast-value-factory.h",
    "upstream/src/ast/ast.cc",
    "upstream/src/ast/ast.h",
    "upstream/src/ast/modules.cc",
    "upstream/src/ast/modules.h",
    "upstream/src/ast/prettyprinter.cc",
    "upstream/src/ast/prettyprinter.h",
    "upstream/src/ast/scopeinfo.cc",
    "upstream/src/ast/scopeinfo.h",
    "upstream/src/ast/scopes.cc",
    "upstream/src/ast/scopes.h",
    "upstream/src/ast/variables.cc",
    "upstream/src/ast/variables.h",
    "upstream/src/atomic-utils.h",
    "upstream/src/background-parsing-task.cc",
    "upstream/src/background-parsing-task.h",
    "upstream/src/bailout-reason.cc",
    "upstream/src/bailout-reason.h",
    "upstream/src/basic-block-profiler.cc",
    "upstream/src/basic-block-profiler.h",
    "upstream/src/bignum-dtoa.cc",
    "upstream/src/bignum-dtoa.h",
    "upstream/src/bignum.cc",
    "upstream/src/bignum.h",
    "upstream/src/bit-vector.cc",
    "upstream/src/bit-vector.h",
    "upstream/src/bootstrapper.cc",
    "upstream/src/bootstrapper.h",
    "upstream/src/builtins.cc",
    "upstream/src/builtins.h",
    "upstream/src/cancelable-task.cc",
    "upstream/src/cancelable-task.h",
    "upstream/src/cached-powers.cc",
    "upstream/src/cached-powers.h",
    "upstream/src/char-predicates.cc",
    "upstream/src/char-predicates-inl.h",
    "upstream/src/char-predicates.h",
    "upstream/src/checks.h",
    "upstream/src/code-factory.cc",
    "upstream/src/code-factory.h",
    "upstream/src/code-stubs.cc",
    "upstream/src/code-stubs.h",
    "upstream/src/code-stubs-hydrogen.cc",
    "upstream/src/codegen.cc",
    "upstream/src/codegen.h",
    "upstream/src/compilation-cache.cc",
    "upstream/src/compilation-cache.h",
    "upstream/src/compilation-dependencies.cc",
    "upstream/src/compilation-dependencies.h",
    "upstream/src/compilation-statistics.cc",
    "upstream/src/compilation-statistics.h",
    "upstream/src/compiler/access-builder.cc",
    "upstream/src/compiler/access-builder.h",
    "upstream/src/compiler/access-info.cc",
    "upstream/src/compiler/access-info.h",
    "upstream/src/compiler/all-nodes.cc",
    "upstream/src/compiler/all-nodes.h",
    "upstream/src/compiler/ast-graph-builder.cc",
    "upstream/src/compiler/ast-graph-builder.h",
    "upstream/src/compiler/ast-loop-assignment-analyzer.cc",
    "upstream/src/compiler/ast-loop-assignment-analyzer.h",
    "upstream/src/compiler/basic-block-instrumentor.cc",
    "upstream/src/compiler/basic-block-instrumentor.h",
    "upstream/src/compiler/branch-elimination.cc",
    "upstream/src/compiler/branch-elimination.h",
    "upstream/src/compiler/bytecode-branch-analysis.cc",
    "upstream/src/compiler/bytecode-branch-analysis.h",
    "upstream/src/compiler/bytecode-graph-builder.cc",
    "upstream/src/compiler/bytecode-graph-builder.h",
    "upstream/src/compiler/change-lowering.cc",
    "upstream/src/compiler/change-lowering.h",
    "upstream/src/compiler/c-linkage.cc",
    "upstream/src/compiler/coalesced-live-ranges.cc",
    "upstream/src/compiler/coalesced-live-ranges.h",
    "upstream/src/compiler/code-generator-impl.h",
    "upstream/src/compiler/code-generator.cc",
    "upstream/src/compiler/code-generator.h",
    "upstream/src/compiler/code-stub-assembler.cc",
    "upstream/src/compiler/code-stub-assembler.h",
    "upstream/src/compiler/common-node-cache.cc",
    "upstream/src/compiler/common-node-cache.h",
    "upstream/src/compiler/common-operator-reducer.cc",
    "upstream/src/compiler/common-operator-reducer.h",
    "upstream/src/compiler/common-operator.cc",
    "upstream/src/compiler/common-operator.h",
    "upstream/src/compiler/control-builders.cc",
    "upstream/src/compiler/control-builders.h",
    "upstream/src/compiler/control-equivalence.cc",
    "upstream/src/compiler/control-equivalence.h",
    "upstream/src/compiler/control-flow-optimizer.cc",
    "upstream/src/compiler/control-flow-optimizer.h",
    "upstream/src/compiler/dead-code-elimination.cc",
    "upstream/src/compiler/dead-code-elimination.h",
    "upstream/src/compiler/diamond.h",
    "upstream/src/compiler/escape-analysis.cc",
    "upstream/src/compiler/escape-analysis.h",
    "upstream/src/compiler/escape-analysis-reducer.cc",
    "upstream/src/compiler/escape-analysis-reducer.h",
    "upstream/src/compiler/fast-accessor-assembler.cc",
    "upstream/src/compiler/fast-accessor-assembler.h",
    "upstream/src/compiler/frame.cc",
    "upstream/src/compiler/frame.h",
    "upstream/src/compiler/frame-elider.cc",
    "upstream/src/compiler/frame-elider.h",
    "upstream/src/compiler/frame-states.cc",
    "upstream/src/compiler/frame-states.h",
    "upstream/src/compiler/gap-resolver.cc",
    "upstream/src/compiler/gap-resolver.h",
    "upstream/src/compiler/graph-reducer.cc",
    "upstream/src/compiler/graph-reducer.h",
    "upstream/src/compiler/graph-replay.cc",
    "upstream/src/compiler/graph-replay.h",
    "upstream/src/compiler/graph-trimmer.cc",
    "upstream/src/compiler/graph-trimmer.h",
    "upstream/src/compiler/graph-visualizer.cc",
    "upstream/src/compiler/graph-visualizer.h",
    "upstream/src/compiler/graph.cc",
    "upstream/src/compiler/graph.h",
    "upstream/src/compiler/greedy-allocator.cc",
    "upstream/src/compiler/greedy-allocator.h",
    "upstream/src/compiler/instruction-codes.h",
    "upstream/src/compiler/instruction-scheduler.cc",
    "upstream/src/compiler/instruction-scheduler.h",
    "upstream/src/compiler/instruction-selector-impl.h",
    "upstream/src/compiler/instruction-selector.cc",
    "upstream/src/compiler/instruction-selector.h",
    "upstream/src/compiler/instruction.cc",
    "upstream/src/compiler/instruction.h",
    "upstream/src/compiler/interpreter-assembler.cc",
    "upstream/src/compiler/interpreter-assembler.h",
    "upstream/src/compiler/js-builtin-reducer.cc",
    "upstream/src/compiler/js-builtin-reducer.h",
    "upstream/src/compiler/js-call-reducer.cc",
    "upstream/src/compiler/js-call-reducer.h",
    "upstream/src/compiler/js-context-relaxation.cc",
    "upstream/src/compiler/js-context-relaxation.h",
    "upstream/src/compiler/js-context-specialization.cc",
    "upstream/src/compiler/js-context-specialization.h",
    "upstream/src/compiler/js-frame-specialization.cc",
    "upstream/src/compiler/js-frame-specialization.h",
    "upstream/src/compiler/js-generic-lowering.cc",
    "upstream/src/compiler/js-generic-lowering.h",
    "upstream/src/compiler/js-global-object-specialization.cc",
    "upstream/src/compiler/js-global-object-specialization.h",
    "upstream/src/compiler/js-graph.cc",
    "upstream/src/compiler/js-graph.h",
    "upstream/src/compiler/js-inlining.cc",
    "upstream/src/compiler/js-inlining.h",
    "upstream/src/compiler/js-inlining-heuristic.cc",
    "upstream/src/compiler/js-inlining-heuristic.h",
    "upstream/src/compiler/js-intrinsic-lowering.cc",
    "upstream/src/compiler/js-intrinsic-lowering.h",
    "upstream/src/compiler/js-native-context-specialization.cc",
    "upstream/src/compiler/js-native-context-specialization.h",
    "upstream/src/compiler/js-operator.cc",
    "upstream/src/compiler/js-operator.h",
    "upstream/src/compiler/js-typed-lowering.cc",
    "upstream/src/compiler/js-typed-lowering.h",
    "upstream/src/compiler/jump-threading.cc",
    "upstream/src/compiler/jump-threading.h",
    "upstream/src/compiler/linkage.cc",
    "upstream/src/compiler/linkage.h",
    "upstream/src/compiler/live-range-separator.cc",
    "upstream/src/compiler/live-range-separator.h",
    "upstream/src/compiler/liveness-analyzer.cc",
    "upstream/src/compiler/liveness-analyzer.h",
    "upstream/src/compiler/load-elimination.cc",
    "upstream/src/compiler/load-elimination.h",
    "upstream/src/compiler/loop-peeling.cc",
    "upstream/src/compiler/loop-analysis.cc",
    "upstream/src/compiler/loop-analysis.h",
    "upstream/src/compiler/machine-operator-reducer.cc",
    "upstream/src/compiler/machine-operator-reducer.h",
    "upstream/src/compiler/machine-operator.cc",
    "upstream/src/compiler/machine-operator.h",
    "upstream/src/compiler/move-optimizer.cc",
    "upstream/src/compiler/move-optimizer.h",
    "upstream/src/compiler/node-aux-data.h",
    "upstream/src/compiler/node-cache.cc",
    "upstream/src/compiler/node-cache.h",
    "upstream/src/compiler/node-marker.cc",
    "upstream/src/compiler/node-marker.h",
    "upstream/src/compiler/node-matchers.cc",
    "upstream/src/compiler/node-matchers.h",
    "upstream/src/compiler/node-properties.cc",
    "upstream/src/compiler/node-properties.h",
    "upstream/src/compiler/node.cc",
    "upstream/src/compiler/node.h",
    "upstream/src/compiler/opcodes.cc",
    "upstream/src/compiler/opcodes.h",
    "upstream/src/compiler/operator-properties.cc",
    "upstream/src/compiler/operator-properties.h",
    "upstream/src/compiler/operator.cc",
    "upstream/src/compiler/operator.h",
    "upstream/src/compiler/osr.cc",
    "upstream/src/compiler/osr.h",
    "upstream/src/compiler/loop-peeling.h",
    "upstream/src/compiler/pipeline.cc",
    "upstream/src/compiler/pipeline.h",
    "upstream/src/compiler/pipeline-statistics.cc",
    "upstream/src/compiler/pipeline-statistics.h",
    "upstream/src/compiler/raw-machine-assembler.cc",
    "upstream/src/compiler/raw-machine-assembler.h",
    "upstream/src/compiler/register-allocator.cc",
    "upstream/src/compiler/register-allocator.h",
    "upstream/src/compiler/register-allocator-verifier.cc",
    "upstream/src/compiler/register-allocator-verifier.h",
    "upstream/src/compiler/representation-change.cc",
    "upstream/src/compiler/representation-change.h",
    "upstream/src/compiler/schedule.cc",
    "upstream/src/compiler/schedule.h",
    "upstream/src/compiler/scheduler.cc",
    "upstream/src/compiler/scheduler.h",
    "upstream/src/compiler/select-lowering.cc",
    "upstream/src/compiler/select-lowering.h",
    "upstream/src/compiler/simplified-lowering.cc",
    "upstream/src/compiler/simplified-lowering.h",
    "upstream/src/compiler/simplified-operator-reducer.cc",
    "upstream/src/compiler/simplified-operator-reducer.h",
    "upstream/src/compiler/simplified-operator.cc",
    "upstream/src/compiler/simplified-operator.h",
    "upstream/src/compiler/source-position.cc",
    "upstream/src/compiler/source-position.h",
    "upstream/src/compiler/state-values-utils.cc",
    "upstream/src/compiler/state-values-utils.h",
    "upstream/src/compiler/tail-call-optimization.cc",
    "upstream/src/compiler/tail-call-optimization.h",
    "upstream/src/compiler/type-hint-analyzer.cc",
    "upstream/src/compiler/type-hint-analyzer.h",
    "upstream/src/compiler/type-hints.cc",
    "upstream/src/compiler/type-hints.h",
    "upstream/src/compiler/typer.cc",
    "upstream/src/compiler/typer.h",
    "upstream/src/compiler/value-numbering-reducer.cc",
    "upstream/src/compiler/value-numbering-reducer.h",
    "upstream/src/compiler/verifier.cc",
    "upstream/src/compiler/verifier.h",
    "upstream/src/compiler/wasm-compiler.cc",
    "upstream/src/compiler/wasm-compiler.h",
    "upstream/src/compiler/wasm-linkage.cc",
    "upstream/src/compiler/zone-pool.cc",
    "upstream/src/compiler/zone-pool.h",
    "upstream/src/compiler.cc",
    "upstream/src/compiler.h",
    "upstream/src/context-measure.cc",
    "upstream/src/context-measure.h",
    "upstream/src/contexts-inl.h",
    "upstream/src/contexts.cc",
    "upstream/src/contexts.h",
    "upstream/src/conversions-inl.h",
    "upstream/src/conversions.cc",
    "upstream/src/conversions.h",
    "upstream/src/counters.cc",
    "upstream/src/counters.h",
    "upstream/src/crankshaft/hydrogen-alias-analysis.h",
    "upstream/src/crankshaft/hydrogen-bce.cc",
    "upstream/src/crankshaft/hydrogen-bce.h",
    "upstream/src/crankshaft/hydrogen-bch.cc",
    "upstream/src/crankshaft/hydrogen-bch.h",
    "upstream/src/crankshaft/hydrogen-canonicalize.cc",
    "upstream/src/crankshaft/hydrogen-canonicalize.h",
    "upstream/src/crankshaft/hydrogen-check-elimination.cc",
    "upstream/src/crankshaft/hydrogen-check-elimination.h",
    "upstream/src/crankshaft/hydrogen-dce.cc",
    "upstream/src/crankshaft/hydrogen-dce.h",
    "upstream/src/crankshaft/hydrogen-dehoist.cc",
    "upstream/src/crankshaft/hydrogen-dehoist.h",
    "upstream/src/crankshaft/hydrogen-environment-liveness.cc",
    "upstream/src/crankshaft/hydrogen-environment-liveness.h",
    "upstream/src/crankshaft/hydrogen-escape-analysis.cc",
    "upstream/src/crankshaft/hydrogen-escape-analysis.h",
    "upstream/src/crankshaft/hydrogen-flow-engine.h",
    "upstream/src/crankshaft/hydrogen-gvn.cc",
    "upstream/src/crankshaft/hydrogen-gvn.h",
    "upstream/src/crankshaft/hydrogen-infer-representation.cc",
    "upstream/src/crankshaft/hydrogen-infer-representation.h",
    "upstream/src/crankshaft/hydrogen-infer-types.cc",
    "upstream/src/crankshaft/hydrogen-infer-types.h",
    "upstream/src/crankshaft/hydrogen-instructions.cc",
    "upstream/src/crankshaft/hydrogen-instructions.h",
    "upstream/src/crankshaft/hydrogen-load-elimination.cc",
    "upstream/src/crankshaft/hydrogen-load-elimination.h",
    "upstream/src/crankshaft/hydrogen-mark-deoptimize.cc",
    "upstream/src/crankshaft/hydrogen-mark-deoptimize.h",
    "upstream/src/crankshaft/hydrogen-mark-unreachable.cc",
    "upstream/src/crankshaft/hydrogen-mark-unreachable.h",
    "upstream/src/crankshaft/hydrogen-osr.cc",
    "upstream/src/crankshaft/hydrogen-osr.h",
    "upstream/src/crankshaft/hydrogen-range-analysis.cc",
    "upstream/src/crankshaft/hydrogen-range-analysis.h",
    "upstream/src/crankshaft/hydrogen-redundant-phi.cc",
    "upstream/src/crankshaft/hydrogen-redundant-phi.h",
    "upstream/src/crankshaft/hydrogen-removable-simulates.cc",
    "upstream/src/crankshaft/hydrogen-removable-simulates.h",
    "upstream/src/crankshaft/hydrogen-representation-changes.cc",
    "upstream/src/crankshaft/hydrogen-representation-changes.h",
    "upstream/src/crankshaft/hydrogen-sce.cc",
    "upstream/src/crankshaft/hydrogen-sce.h",
    "upstream/src/crankshaft/hydrogen-store-elimination.cc",
    "upstream/src/crankshaft/hydrogen-store-elimination.h",
    "upstream/src/crankshaft/hydrogen-types.cc",
    "upstream/src/crankshaft/hydrogen-types.h",
    "upstream/src/crankshaft/hydrogen-uint32-analysis.cc",
    "upstream/src/crankshaft/hydrogen-uint32-analysis.h",
    "upstream/src/crankshaft/hydrogen.cc",
    "upstream/src/crankshaft/hydrogen.h",
    "upstream/src/crankshaft/lithium-allocator-inl.h",
    "upstream/src/crankshaft/lithium-allocator.cc",
    "upstream/src/crankshaft/lithium-allocator.h",
    "upstream/src/crankshaft/lithium-codegen.cc",
    "upstream/src/crankshaft/lithium-codegen.h",
    "upstream/src/crankshaft/lithium.cc",
    "upstream/src/crankshaft/lithium.h",
    "upstream/src/crankshaft/typing.cc",
    "upstream/src/crankshaft/typing.h",
    "upstream/src/crankshaft/unique.h",
    "upstream/src/date.cc",
    "upstream/src/date.h",
    "upstream/src/dateparser-inl.h",
    "upstream/src/dateparser.cc",
    "upstream/src/dateparser.h",
    "upstream/src/debug/debug-evaluate.cc",
    "upstream/src/debug/debug-evaluate.h",
    "upstream/src/debug/debug-frames.cc",
    "upstream/src/debug/debug-frames.h",
    "upstream/src/debug/debug-scopes.cc",
    "upstream/src/debug/debug-scopes.h",
    "upstream/src/debug/debug.cc",
    "upstream/src/debug/debug.h",
    "upstream/src/debug/liveedit.cc",
    "upstream/src/debug/liveedit.h",
    "upstream/src/deoptimizer.cc",
    "upstream/src/deoptimizer.h",
    "upstream/src/disasm.h",
    "upstream/src/disassembler.cc",
    "upstream/src/disassembler.h",
    "upstream/src/diy-fp.cc",
    "upstream/src/diy-fp.h",
    "upstream/src/double.h",
    "upstream/src/dtoa.cc",
    "upstream/src/dtoa.h",
    "upstream/src/effects.h",
    "upstream/src/elements-kind.cc",
    "upstream/src/elements-kind.h",
    "upstream/src/elements.cc",
    "upstream/src/elements.h",
    "upstream/src/execution.cc",
    "upstream/src/execution.h",
    "upstream/src/extensions/externalize-string-extension.cc",
    "upstream/src/extensions/externalize-string-extension.h",
    "upstream/src/extensions/free-buffer-extension.cc",
    "upstream/src/extensions/free-buffer-extension.h",
    "upstream/src/extensions/gc-extension.cc",
    "upstream/src/extensions/gc-extension.h",
    "upstream/src/extensions/statistics-extension.cc",
    "upstream/src/extensions/statistics-extension.h",
    "upstream/src/extensions/trigger-failure-extension.cc",
    "upstream/src/extensions/trigger-failure-extension.h",
    "upstream/src/factory.cc",
    "upstream/src/factory.h",
    "upstream/src/fast-dtoa.cc",
    "upstream/src/fast-dtoa.h",
    "upstream/src/field-index.h",
    "upstream/src/field-index-inl.h",
    "upstream/src/fixed-dtoa.cc",
    "upstream/src/fixed-dtoa.h",
    "upstream/src/flag-definitions.h",
    "upstream/src/flags.cc",
    "upstream/src/flags.h",
    "upstream/src/frames-inl.h",
    "upstream/src/frames.cc",
    "upstream/src/frames.h",
    "upstream/src/full-codegen/full-codegen.cc",
    "upstream/src/full-codegen/full-codegen.h",
    "upstream/src/futex-emulation.cc",
    "upstream/src/futex-emulation.h",
    "upstream/src/gdb-jit.cc",
    "upstream/src/gdb-jit.h",
    "upstream/src/global-handles.cc",
    "upstream/src/global-handles.h",
    "upstream/src/globals.h",
    "upstream/src/handles-inl.h",
    "upstream/src/handles.cc",
    "upstream/src/handles.h",
    "upstream/src/hashmap.h",
    "upstream/src/heap/incremental-marking-inl.h",
    "upstream/src/heap/array-buffer-tracker.cc",
    "upstream/src/heap/array-buffer-tracker.h",
    "upstream/src/heap/gc-idle-time-handler.cc",
    "upstream/src/heap/gc-idle-time-handler.h",
    "upstream/src/heap/gc-tracer.cc",
    "upstream/src/heap/gc-tracer.h",
    "upstream/src/heap/heap-inl.h",
    "upstream/src/heap/heap.cc",
    "upstream/src/heap/heap.h",
    "upstream/src/heap/incremental-marking-job.cc",
    "upstream/src/heap/incremental-marking-job.h",
    "upstream/src/heap/incremental-marking.cc",
    "upstream/src/heap/incremental-marking.h",
    "upstream/src/heap/mark-compact-inl.h",
    "upstream/src/heap/mark-compact.cc",
    "upstream/src/heap/mark-compact.h",
    "upstream/src/heap/memory-reducer.cc",
    "upstream/src/heap/memory-reducer.h",
    "upstream/src/heap/object-stats.cc",
    "upstream/src/heap/object-stats.h",
    "upstream/src/heap/objects-visiting-inl.h",
    "upstream/src/heap/objects-visiting.cc",
    "upstream/src/heap/objects-visiting.h",
    "upstream/src/heap/scavenge-job.h",
    "upstream/src/heap/scavenge-job.cc",
    "upstream/src/heap/scavenger-inl.h",
    "upstream/src/heap/scavenger.cc",
    "upstream/src/heap/scavenger.h",
    "upstream/src/heap/slots-buffer.cc",
    "upstream/src/heap/slots-buffer.h",
    "upstream/src/heap/spaces-inl.h",
    "upstream/src/heap/spaces.cc",
    "upstream/src/heap/spaces.h",
    "upstream/src/heap/store-buffer-inl.h",
    "upstream/src/heap/store-buffer.cc",
    "upstream/src/heap/store-buffer.h",
    #"upstream/src/i18n.cc",
    #"upstream/src/i18n.h",
    "upstream/src/icu_util.cc",
    "upstream/src/icu_util.h",
    "upstream/src/ic/access-compiler.cc",
    "upstream/src/ic/access-compiler.h",
    "upstream/src/ic/call-optimization.cc",
    "upstream/src/ic/call-optimization.h",
    "upstream/src/ic/handler-compiler.cc",
    "upstream/src/ic/handler-compiler.h",
    "upstream/src/ic/ic-inl.h",
    "upstream/src/ic/ic-state.cc",
    "upstream/src/ic/ic-state.h",
    "upstream/src/ic/ic.cc",
    "upstream/src/ic/ic.h",
    "upstream/src/ic/ic-compiler.cc",
    "upstream/src/ic/ic-compiler.h",
    "upstream/src/ic/stub-cache.cc",
    "upstream/src/ic/stub-cache.h",
    "upstream/src/identity-map.cc",
    "upstream/src/identity-map.h",
    "upstream/src/interface-descriptors.cc",
    "upstream/src/interface-descriptors.h",
    "upstream/src/interpreter/bytecodes.cc",
    "upstream/src/interpreter/bytecodes.h",
    "upstream/src/interpreter/bytecode-array-builder.cc",
    "upstream/src/interpreter/bytecode-array-builder.h",
    "upstream/src/interpreter/bytecode-array-iterator.cc",
    "upstream/src/interpreter/bytecode-array-iterator.h",
    "upstream/src/interpreter/bytecode-generator.cc",
    "upstream/src/interpreter/bytecode-generator.h",
    "upstream/src/interpreter/bytecode-register-allocator.cc",
    "upstream/src/interpreter/bytecode-register-allocator.h",
    "upstream/src/interpreter/bytecode-traits.h",
    "upstream/src/interpreter/constant-array-builder.cc",
    "upstream/src/interpreter/constant-array-builder.h",
    "upstream/src/interpreter/control-flow-builders.cc",
    "upstream/src/interpreter/control-flow-builders.h",
    "upstream/src/interpreter/handler-table-builder.cc",
    "upstream/src/interpreter/handler-table-builder.h",
    "upstream/src/interpreter/interpreter.cc",
    "upstream/src/interpreter/interpreter.h",
    "upstream/src/isolate-inl.h",
    "upstream/src/isolate.cc",
    "upstream/src/isolate.h",
    "upstream/src/json-stringifier.h",
    "upstream/src/key-accumulator.h",
    "upstream/src/key-accumulator.cc",
    "upstream/src/layout-descriptor-inl.h",
    "upstream/src/layout-descriptor.cc",
    "upstream/src/layout-descriptor.h",
    "upstream/src/list-inl.h",
    "upstream/src/list.h",
    "upstream/src/log-inl.h",
    "upstream/src/log-utils.cc",
    "upstream/src/log-utils.h",
    "upstream/src/log.cc",
    "upstream/src/log.h",
    "upstream/src/lookup.cc",
    "upstream/src/lookup.h",
    "upstream/src/macro-assembler.h",
    "upstream/src/machine-type.cc",
    "upstream/src/machine-type.h",
    "upstream/src/messages.cc",
    "upstream/src/messages.h",
    "upstream/src/msan.h",
    "upstream/src/objects-body-descriptors-inl.h",
    "upstream/src/objects-body-descriptors.h",
    "upstream/src/objects-debug.cc",
    "upstream/src/objects-inl.h",
    "upstream/src/objects-printer.cc",
    "upstream/src/objects.cc",
    "upstream/src/objects.h",
    "upstream/src/optimizing-compile-dispatcher.cc",
    "upstream/src/optimizing-compile-dispatcher.h",
    "upstream/src/ostreams.cc",
    "upstream/src/ostreams.h",
    "upstream/src/parsing/expression-classifier.h",
    "upstream/src/parsing/func-name-inferrer.cc",
    "upstream/src/parsing/func-name-inferrer.h",
    "upstream/src/parsing/json-parser.h",
    "upstream/src/parsing/parameter-initializer-rewriter.cc",
    "upstream/src/parsing/parameter-initializer-rewriter.h",
    "upstream/src/parsing/parser-base.h",
    "upstream/src/parsing/parser.cc",
    "upstream/src/parsing/parser.h",
    "upstream/src/parsing/pattern-rewriter.cc",
    "upstream/src/parsing/preparse-data-format.h",
    "upstream/src/parsing/preparse-data.cc",
    "upstream/src/parsing/preparse-data.h",
    "upstream/src/parsing/preparser.cc",
    "upstream/src/parsing/preparser.h",
    "upstream/src/parsing/rewriter.cc",
    "upstream/src/parsing/rewriter.h",
    "upstream/src/parsing/scanner-character-streams.cc",
    "upstream/src/parsing/scanner-character-streams.h",
    "upstream/src/parsing/scanner.cc",
    "upstream/src/parsing/scanner.h",
    "upstream/src/parsing/token.cc",
    "upstream/src/parsing/token.h",
    "upstream/src/pending-compilation-error-handler.cc",
    "upstream/src/pending-compilation-error-handler.h",
    "upstream/src/profiler/allocation-tracker.cc",
    "upstream/src/profiler/allocation-tracker.h",
    "upstream/src/profiler/circular-queue-inl.h",
    "upstream/src/profiler/circular-queue.h",
    "upstream/src/profiler/cpu-profiler-inl.h",
    "upstream/src/profiler/cpu-profiler.cc",
    "upstream/src/profiler/cpu-profiler.h",
    "upstream/src/profiler/heap-profiler.cc",
    "upstream/src/profiler/heap-profiler.h",
    "upstream/src/profiler/heap-snapshot-generator-inl.h",
    "upstream/src/profiler/heap-snapshot-generator.cc",
    "upstream/src/profiler/heap-snapshot-generator.h",
    "upstream/src/profiler/profile-generator-inl.h",
    "upstream/src/profiler/profile-generator.cc",
    "upstream/src/profiler/profile-generator.h",
    "upstream/src/profiler/sampler.cc",
    "upstream/src/profiler/sampler.h",
    "upstream/src/profiler/strings-storage.cc",
    "upstream/src/profiler/strings-storage.h",
    "upstream/src/profiler/unbound-queue-inl.h",
    "upstream/src/profiler/unbound-queue.h",
    "upstream/src/property-descriptor.cc",
    "upstream/src/property-descriptor.h",
    "upstream/src/property-details.h",
    "upstream/src/property.cc",
    "upstream/src/property.h",
    "upstream/src/prototype.h",
    "upstream/src/regexp/bytecodes-irregexp.h",
    "upstream/src/regexp/interpreter-irregexp.cc",
    "upstream/src/regexp/interpreter-irregexp.h",
    "upstream/src/regexp/jsregexp-inl.h",
    "upstream/src/regexp/jsregexp.cc",
    "upstream/src/regexp/jsregexp.h",
    "upstream/src/regexp/regexp-ast.cc",
    "upstream/src/regexp/regexp-ast.h",
    "upstream/src/regexp/regexp-macro-assembler-irregexp-inl.h",
    "upstream/src/regexp/regexp-macro-assembler-irregexp.cc",
    "upstream/src/regexp/regexp-macro-assembler-irregexp.h",
    "upstream/src/regexp/regexp-macro-assembler-tracer.cc",
    "upstream/src/regexp/regexp-macro-assembler-tracer.h",
    "upstream/src/regexp/regexp-macro-assembler.cc",
    "upstream/src/regexp/regexp-macro-assembler.h",
    "upstream/src/regexp/regexp-parser.cc",
    "upstream/src/regexp/regexp-parser.h",
    "upstream/src/regexp/regexp-stack.cc",
    "upstream/src/regexp/regexp-stack.h",
    "upstream/src/register-configuration.cc",
    "upstream/src/register-configuration.h",
    "upstream/src/runtime-profiler.cc",
    "upstream/src/runtime-profiler.h",
    "upstream/src/runtime/runtime-array.cc",
    "upstream/src/runtime/runtime-atomics.cc",
    "upstream/src/runtime/runtime-classes.cc",
    "upstream/src/runtime/runtime-collections.cc",
    "upstream/src/runtime/runtime-compiler.cc",
    "upstream/src/runtime/runtime-date.cc",
    "upstream/src/runtime/runtime-debug.cc",
    "upstream/src/runtime/runtime-forin.cc",
    "upstream/src/runtime/runtime-function.cc",
    "upstream/src/runtime/runtime-futex.cc",
    "upstream/src/runtime/runtime-generator.cc",
    "upstream/src/runtime/runtime-i18n.cc",
    "upstream/src/runtime/runtime-internal.cc",
    "upstream/src/runtime/runtime-interpreter.cc",
    "upstream/src/runtime/runtime-json.cc",
    "upstream/src/runtime/runtime-literals.cc",
    "upstream/src/runtime/runtime-liveedit.cc",
    "upstream/src/runtime/runtime-maths.cc",
    "upstream/src/runtime/runtime-numbers.cc",
    "upstream/src/runtime/runtime-object.cc",
    "upstream/src/runtime/runtime-observe.cc",
    "upstream/src/runtime/runtime-operators.cc",
    "upstream/src/runtime/runtime-proxy.cc",
    "upstream/src/runtime/runtime-regexp.cc",
    "upstream/src/runtime/runtime-scopes.cc",
    "upstream/src/runtime/runtime-simd.cc",
    "upstream/src/runtime/runtime-strings.cc",
    "upstream/src/runtime/runtime-symbol.cc",
    "upstream/src/runtime/runtime-test.cc",
    "upstream/src/runtime/runtime-typedarray.cc",
    "upstream/src/runtime/runtime-uri.cc",
    "upstream/src/runtime/runtime-utils.h",
    "upstream/src/runtime/runtime.cc",
    "upstream/src/runtime/runtime.h",
    "upstream/src/safepoint-table.cc",
    "upstream/src/safepoint-table.h",
    "upstream/src/signature.h",
    "upstream/src/simulator.h",
    "upstream/src/small-pointer-list.h",
    "upstream/src/snapshot/natives.h",
    "upstream/src/snapshot/natives-common.cc",
    "upstream/src/snapshot/serialize.cc",
    "upstream/src/snapshot/serialize.h",
    "upstream/src/snapshot/snapshot-common.cc",
    "upstream/src/snapshot/snapshot-source-sink.cc",
    "upstream/src/snapshot/snapshot-source-sink.h",
    "upstream/src/source-position.h",
    "upstream/src/splay-tree.h",
    "upstream/src/splay-tree-inl.h",
    "upstream/src/snapshot/snapshot.h",
    "upstream/src/startup-data-util.h",
    "upstream/src/startup-data-util.cc",
    "upstream/src/string-builder.cc",
    "upstream/src/string-builder.h",
    "upstream/src/string-search.h",
    "upstream/src/string-stream.cc",
    "upstream/src/string-stream.h",
    "upstream/src/strtod.cc",
    "upstream/src/strtod.h",
    "upstream/src/tracing/trace-event.cc",
    "upstream/src/tracing/trace-event.h",
    "upstream/src/transitions-inl.h",
    "upstream/src/transitions.cc",
    "upstream/src/transitions.h",
    "upstream/src/type-cache.cc",
    "upstream/src/type-cache.h",
    "upstream/src/type-feedback-vector-inl.h",
    "upstream/src/type-feedback-vector.cc",
    "upstream/src/type-feedback-vector.h",
    "upstream/src/type-info.cc",
    "upstream/src/type-info.h",
    "upstream/src/types-inl.h",
    "upstream/src/types.cc",
    "upstream/src/types.h",
    "upstream/src/typing-asm.cc",
    "upstream/src/typing-asm.h",
    "upstream/src/typing-reset.cc",
    "upstream/src/typing-reset.h",
    "upstream/src/unicode-inl.h",
    "upstream/src/unicode.cc",
    "upstream/src/unicode.h",
    "upstream/src/unicode-cache-inl.h",
    "upstream/src/unicode-cache.h",
    "upstream/src/unicode-decoder.cc",
    "upstream/src/unicode-decoder.h",
    "upstream/src/utils.cc",
    "upstream/src/utils.h",
    "upstream/src/v8.cc",
    "upstream/src/v8.h",
    "upstream/src/v8memory.h",
    "upstream/src/v8threads.cc",
    "upstream/src/v8threads.h",
    "upstream/src/version.cc",
    "upstream/src/version.h",
    "upstream/src/vm-state-inl.h",
    "upstream/src/vm-state.h",
    "upstream/src/wasm/asm-wasm-builder.cc",
    "upstream/src/wasm/asm-wasm-builder.h",
    "upstream/src/wasm/ast-decoder.cc",
    "upstream/src/wasm/ast-decoder.h",
    "upstream/src/wasm/decoder.h",
    "upstream/src/wasm/encoder.cc",
    "upstream/src/wasm/encoder.h",
    "upstream/src/wasm/module-decoder.cc",
    "upstream/src/wasm/module-decoder.h",
    "upstream/src/wasm/wasm-js.cc",
    "upstream/src/wasm/wasm-js.h",
    "upstream/src/wasm/wasm-macro-gen.h",
    "upstream/src/wasm/wasm-module.cc",
    "upstream/src/wasm/wasm-module.h",
    "upstream/src/wasm/wasm-opcodes.cc",
    "upstream/src/wasm/wasm-opcodes.h",
    "upstream/src/wasm/wasm-result.cc",
    "upstream/src/wasm/wasm-result.h",
    "upstream/src/zone.cc",
    "upstream/src/zone.h",
    "upstream/src/zone-allocator.h",
    "upstream/src/zone-containers.h",
    "upstream/src/third_party/fdlibm/fdlibm.cc",
    "upstream/src/third_party/fdlibm/fdlibm.h",
    #
    "upstream/src/crankshaft/lithium-inl.h",
    # x64
    "upstream/src/third_party/valgrind/valgrind.h",
    "upstream/src/x64/simulator-x64.h",
    "upstream/src/compiler/x64/code-generator-x64.cc",
    "upstream/src/compiler/x64/instruction-codes-x64.h",
    "upstream/src/compiler/x64/instruction-scheduler-x64.cc",
    "upstream/src/compiler/x64/instruction-selector-x64.cc",
    "upstream/src/crankshaft/x64/lithium-codegen-x64.cc",
    "upstream/src/crankshaft/x64/lithium-codegen-x64.h",
    "upstream/src/crankshaft/x64/lithium-gap-resolver-x64.cc",
    "upstream/src/crankshaft/x64/lithium-gap-resolver-x64.h",
    "upstream/src/crankshaft/x64/lithium-x64.cc",
    "upstream/src/crankshaft/x64/lithium-x64.h",
    "upstream/src/debug/x64/debug-x64.cc",
    "upstream/src/full-codegen/x64/full-codegen-x64.cc",
    "upstream/src/ic/x64/access-compiler-x64.cc",
    "upstream/src/ic/x64/handler-compiler-x64.cc",
    "upstream/src/ic/x64/ic-x64.cc",
    "upstream/src/ic/x64/ic-compiler-x64.cc",
    "upstream/src/ic/x64/stub-cache-x64.cc",
    "upstream/src/regexp/x64/regexp-macro-assembler-x64.cc",
    "upstream/src/regexp/x64/regexp-macro-assembler-x64.h",
    "upstream/src/x64/assembler-x64-inl.h",
    "upstream/src/x64/assembler-x64.cc",
    "upstream/src/x64/assembler-x64.h",
    "upstream/src/x64/builtins-x64.cc",
    "upstream/src/x64/code-stubs-x64.cc",
    "upstream/src/x64/code-stubs-x64.h",
    "upstream/src/x64/codegen-x64.cc",
    "upstream/src/x64/codegen-x64.h",
    "upstream/src/x64/cpu-x64.cc",
    "upstream/src/x64/deoptimizer-x64.cc",
    "upstream/src/x64/disasm-x64.cc",
    "upstream/src/x64/frames-x64.cc",
    "upstream/src/x64/frames-x64.h",
    "upstream/src/x64/interface-descriptors-x64.cc",
    "upstream/src/x64/macro-assembler-x64.cc",
    "upstream/src/x64/macro-assembler-x64.h",
  ],
  includes = [
    ".",
  ],
  linkopts = [
    "-lm",
  ],
  deps = [
    ":v8_libbase",
  ],
)

cc_library(
  name = "v8_libplatform",
  visibility = [ "//visibility:public" ],
  srcs = [
    "upstream/include/v8-platform.h",
    "upstream/include/libplatform/libplatform.h",
    "upstream/src/libplatform/default-platform.cc",
    "upstream/src/libplatform/default-platform.h",
    "upstream/src/libplatform/task-queue.cc",
    "upstream/src/libplatform/task-queue.h",
    "upstream/src/libplatform/worker-thread.cc",
    "upstream/src/libplatform/worker-thread.h",
  ],
  deps = [
    ":v8_libbase",
  ]
)

cc_library(
  name = "v8_snapshot",
  srcs = [
    # There is some linkage issue so we have to put api.cc together
    # with snapshot.ccxs
    "upstream/src/api.cc",
    ":run_mksnapshot",
  ],
  deps = [
    ":v8_base",
  ],
)

cc_library(
  name = "v8_nosnapshot",
  srcs = [
    "upstream/src/api.cc",
    "upstream/src/snapshot/snapshot-empty.cc",
  ],
  deps = [
    ":v8_base",
  ],
)

cc_binary(
  name = "d8",
  srcs = [
    "upstream/src/d8.cc",
    "upstream/src/d8.h",
    "upstream/src/d8-posix.cc",
    ":d8_js2c",
  ],
  deps = [
    ":v8",
    ":v8_libplatform",
  ],
)
